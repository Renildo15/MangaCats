{% extends "base_templates/base.html" %}
{% block title %}MangaCats - Read{% endblock title %}
{% block head %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.min.js" integrity="sha512-1/RvZTcCDEUjY/CypiMz+iqqtaoQfAITmNSJY17Myp4Ms5mdxPS5UV7iOfdZoxcGhzFbOm6sntTKJppjvuhg4g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css" integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="text/javascript">
        (function ($) {
            function tinymce4_init(selector) {
                var tinymce4_config = { setup: function (editor) { editor.on('change', function () { editor.save(); }); }, "language": "en", "directionality": "ltr", "cleanup_on_startup": true, "custom_undo_redo_levels": 20, "selector": "textarea.tinymce4-editor", "theme": "modern", "plugins": "\n            textcolor save link image media preview codesample contextmenu\n            table code lists fullscreen  insertdatetime  nonbreaking\n            contextmenu directionality searchreplace wordcount visualblocks\n            visualchars code fullscreen autolink lists  charmap print  hr\n            anchor pagebreak\n            ", "toolbar1": "\n            fullscreen preview bold italic underline | fontselect,\n            fontsizeselect  | forecolor backcolor | alignleft alignright |\n            aligncenter alignjustify | indent outdent | bullist numlist table |\n            | link image media | codesample |\n            ", "toolbar2": "\n            visualblocks visualchars |\n            charmap hr pagebreak nonbreaking anchor |  code |\n            ", "contextmenu": "formats | link image", "menubar": true, "statusbar": true }; if (typeof selector != 'undefined') { tinymce4_config['selector'] = selector; }
                tinymce.init(tinymce4_config);
            }
            tinymce4_init();
        })();

        tinymce.init({
            selector: '.form',
            inline: true,
            menubar: false
    });
  </script>
{{form_comment.media}}
{% endblock head %}
{% block content %}
{% for msg in messages %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{msg}}
            <button type="button" class="btn-close" data-bs-dismiss="alert" arial-label="close"></button>
        </div>
{% endfor %}
{% if pages %}
{% for page in pages %}
    <ul>
        <li> 
            <img src="{{page.image_chapter}}" >
        </li>
    </ul>
    
{% endfor %}   
<div>
    <h3>Comments</h3>
    <hr>
    {% if comments %}
        {% for comment in comments %}
            <ul id="{{comment.id_comment}}">
                <li>{{comment.user}}</li>
                <li>{{comment.comment|safe}}</li>
                <li>{{comment.date_created}}</li>
                {% if perms.comment_app.change_commentchapter and request.user == comment.user%}
                    <li><a href={% url 'comment:comment_chapter_edit' comment.id_comment %}>Edit</a></li>
                    
                {% endif %}     
                {% if perms.comment_app.delete_commentchapter and request.user.is_staff or request.user == comment.user%}
                    <li><a class="btn btn-primary" id="btn-delete" data-chapter="{{comment.id_comment}}">Delete</a></li>
                {% endif %}
                <hr>
            </ul>
        {% endfor %}
    {% else %}

    <h4>Not exists comments</h4>
    {% endif %}
</div>
<div >
    <h3>Add your comment:</h3>
    <hr>
    <form  method="POST" class="form" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            {{form_comment.comment.errors}}
            <label for="">Comment:</label>
            {{form_comment.comment}}
        </div>
        <div>
            <input class="btn btn-primary" type="submit" value="Comment"/>
        </div>
    </form>
</div>
{% else %}

<div>
    <h1>Page not exists!</h1>
</div>

{% endif %}
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<script type="text/javascript"> 
    $("a#btn-delete").on("click", function (e) {
        e.preventDefault();

        var comment_id = $(this).attr("data-chapter");
        console.log(comment_id);

        $.ajax({
            type: 'GET',
            url: '{% url "comment:comment_chapter_delete" %}',
            data: {'comment_id': comment_id},
            datatype: "json",
            success: function(data){
                if(data.status == "delete"){
                    $("ul#" + comment_id).fadeOut("slow", function(){
                        $("ul#" + comment_id).remove();
                    })
                }else{
                    console.log("Erro")
                }
            }
        })
    })

</script>
{% endblock content %}